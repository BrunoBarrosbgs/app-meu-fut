
import type { Match, Player } from './types';

// Helper function to pick a random item from an array
const pickRandom = <T,>(arr: T[]): T => arr[Math.floor(Math.random() * arr.length)];

// --- Tactical Analysis for a Match ---
const tacticalAnalyses = [
    "O advers√°rio parece vulner√°vel a contra-ataques r√°pidos. Explorar a velocidade dos nossos pontas pode ser a chave para a vit√≥ria. √â crucial manter a solidez defensiva e n√£o ceder espa√ßos nas costas da zaga.",
    "A equipe advers√°ria pressiona muito a sa√≠da de bola. Precisaremos de calma e qualidade no passe para superar a primeira linha de marca√ß√£o. Inverter o jogo rapidamente pode pegar a defesa deles desorganizada.",
    "Eles t√™m um meio-campo muito f√≠sico. Evitar o confronto direto e apostar na movimenta√ß√£o e triangula√ß√µes pode ser mais eficaz. Bolas paradas ser√£o uma arma importante hoje.",
    "A principal amea√ßa deles √© o camisa 10. Uma marca√ß√£o individual mais pr√≥xima nele pode neutralizar grande parte do poder de cria√ß√£o do advers√°rio. Devemos ser agressivos, mas leais.",
    "Notamos que o lateral esquerdo deles sobe muito. Podemos explorar esse espa√ßo com lan√ßamentos longos para o nosso ponta direita. A transi√ß√£o defesa-ataque precisa ser rel√¢mpago.",
];

export function getTacticalAnalysis(match: Match): string {
    return pickRandom(tacticalAnalyses);
}


// --- New Detailed Formation Analysis Database ---
const formationAnalyses: Record<string, { philosophy: string; strength: string; weakness: string; instruction: string; }> = {
    // --- CAMPO (11v11) ---
    '4-4-2': {
        philosophy: "A forma√ß√£o mais equilibrada e tradicional. Foca em solidez defensiva com duas linhas de quatro e flexibilidade ofensiva com dois atacantes.",
        strength: "Excelente cobertura do campo, dificultando a cria√ß√£o de jogadas do advers√°rio pelo meio e pelos lados. √â uma forma√ß√£o segura e dif√≠cil de ser batida.",
        weakness: "Pode se tornar previs√≠vel e est√°tico se os meio-campistas e laterais n√£o apoiarem o ataque. H√° um risco de isolamento entre o meio-campo e o ataque.",
        instruction: "A chave √© a movimenta√ß√£o dos homens de meio. Eles precisam 'quebrar as linhas' para se conectar com os atacantes e n√£o deixar o time em dois blocos separados."
    },
    '4-3-3': {
        philosophy: "Foco no ataque e na press√£o alta. Utiliza tr√™s atacantes para alargar o campo, criar superioridade num√©rica ofensiva e pressionar a sa√≠da de bola advers√°ria.",
        strength: "Muito poderoso ofensivamente, com pontas velozes e um centroavante finalizador. Ideal para um estilo de jogo agressivo e de posse de bola.",
        weakness: "Exige muito dos tr√™s meio-campistas para cobrir os espa√ßos, podendo deixar a defesa vulner√°vel a contra-ataques se a press√£o na frente falhar.",
        instruction: "Os pontas devem ser disciplinados na recomposi√ß√£o para ajudar os laterais, transformando o sistema em um 4-5-1 sem a bola."
    },
    '3-5-2': {
        philosophy: "Dominar o meio-campo. Com cinco jogadores no setor, a ideia √© ter a posse de bola e controlar o ritmo do jogo, utilizando alas para dar amplitude.",
        strength: "Superioridade num√©rica no meio-campo, facilitando a manuten√ß√£o da posse e a cria√ß√£o de jogadas. Os alas d√£o largura e profundidade ao time.",
        weakness: "Os espa√ßos nas costas dos alas s√£o o principal ponto fraco. Exige zagueiros r√°pidos e um bom entrosamento na cobertura.",
        instruction: "O sucesso desta forma√ß√£o depende 100% da capacidade f√≠sica e t√°tica dos alas. Eles precisam ter f√¥lego para atacar e defender com a mesma intensidade."
    },
    '4-2-3-1': {
        philosophy: "Uma varia√ß√£o moderna do 4-4-2, focada na figura de um 'camisa 10' centralizado. Proporciona equil√≠brio defensivo e poder de fogo com quatro jogadores no ataque.",
        strength: "Grande flexibilidade t√°tica. O meia-armador central tem liberdade para criar, enquanto os dois volantes protegem a defesa e os pontas d√£o profundidade.",
        weakness: "Depende muito da criatividade do meia-armador. Se ele for bem marcado, o time pode ter dificuldades para criar chances de gol.",
        instruction: "Os volantes precisam ser disciplinados. Um deve ser mais focado na marca√ß√£o, enquanto o outro tem liberdade para se juntar ao ataque como elemento surpresa."
    },
    // --- SOCIETY (7v7) ---
    '2-3-1': {
        philosophy: "Um sistema em formato de diamante que busca o controle do meio-campo e a liga√ß√£o direta com um atacante de refer√™ncia. O 'cabe√ßa de √°rea' √© a √¢ncora defensiva.",
        strength: "Forte presen√ßa no meio-campo, permitindo o controle da posse de bola. O meia central tem liberdade para armar o jogo para os alas e o atacante.",
        weakness: "Exige muito dos dois zagueiros, que ficam frequentemente no mano a mano. Os alas precisam recompor rapidamente para n√£o sobrecarregar a defesa.",
        instruction: "O volante (cabe√ßa de √°rea) √© o jogador mais importante. Ele precisa ter grande leitura de jogo para proteger a zaga e iniciar as jogadas."
    },
    '3-2-1': {
        philosophy: "Prioriza a seguran√ßa defensiva com uma linha de tr√™s zagueiros, liberando os dois meio-campistas para armar e um atacante para finalizar.",
        strength: "Extremamente s√≥lido defensivamente. √â muito dif√≠cil sofrer gols nesta forma√ß√£o, sendo ideal para segurar resultados ou enfrentar advers√°rios mais fortes.",
        weakness: "Pode ser muito defensivo se os zagueiros laterais (ou alas) n√£o avan√ßarem. O time pode ficar sem op√ß√µes de passe no ataque.",
        instruction: "Os dois jogadores de meio precisam ser din√¢micos ('box-to-box'), capazes de defender e atacar, para n√£o deixar o time est√°tico."
    },
    '2-2-2': {
        philosophy: "Conhecido como 'quadrado' ou 'caixote'. √â uma forma√ß√£o que divide o time em tr√™s blocos bem definidos: defesa, meio e ataque.",
        strength: "Simples de entender e executar, mantendo o time sempre compacto. Facilita a cria√ß√£o de linhas de passe curtas e triangula√ß√µes.",
        weakness: "Vulner√°vel a jogadas diagonais e invers√µes de bola, pois n√£o possui um jogador central para cobrir os espa√ßos entre os blocos.",
        instruction: "A comunica√ß√£o e o entrosamento entre as duplas (de zaga, meio e ataque) s√£o fundamentais para a cobertura de espa√ßos e a movimenta√ß√£o coordenada."
    },
    // --- FUTSAL (5v5) ---
    '2-2': {
        philosophy: "Sistema 'quadrado' b√°sico do futsal, com dois jogadores focados na defesa (fixos) e dois na frente (alas/piv√¥).",
        strength: "Estrutura equilibrada e simples, oferecendo seguran√ßa defensiva e op√ß√µes claras no ataque. Ideal para iniciar um trabalho t√°tico.",
        weakness: "Pode se tornar est√°tico e previs√≠vel. Exige que os jogadores troquem de posi√ß√£o para quebrar a marca√ß√£o advers√°ria.",
        instruction: "A movimenta√ß√£o √© tudo. Os jogadores n√£o podem se limitar √†s suas posi√ß√µes iniciais; o 'rod√≠zio' constante √© o que far√° a diferen√ßa."
    },
    '3-1': {
        philosophy: "Utiliza um piv√¥ fixo na frente como refer√™ncia para as jogadas, com tr√™s jogadores atr√°s dando suporte e seguran√ßa defensiva.",
        strength: "Excelente para o jogo de piv√¥, segurando a bola no ataque e esperando a infiltra√ß√£o dos alas. Forte defensivamente.",
        weakness: "Muito dependente da qualidade do piv√¥. Se ele n√£o conseguir segurar a bola, o time fica sem op√ß√µes de ataque.",
        instruction: "Os alas precisam ser r√°pidos e inteligentes para atacar o espa√ßo nas costas da defesa advers√°ria assim que o piv√¥ recebe a bola."
    },
    '1-2-1': {
        philosophy: "Sistema 'losango', muito din√¢mico e moderno. Utiliza um fixo, dois alas e um piv√¥, cobrindo bem a quadra em todas as fases do jogo.",
        strength: "√â a forma√ß√£o mais equilibrada do futsal. Permite transi√ß√µes r√°pidas, boa cobertura defensiva e m√∫ltiplas op√ß√µes de passe.",
        weakness: "Exige jogadores muito inteligentes taticamente e com bom preparo f√≠sico, pois a troca de fun√ß√µes √© constante.",
        instruction: "A chave √© o fixo. Ele precisa ser um excelente marcador e, ao mesmo tempo, ter qualidade no passe para armar o jogo de tr√°s."
    }
};


export function getLineupAnalysis(formation: string, starters: Player[], substitutes: Player[]): string {
    const analysis = formationAnalyses[formation];
    if (!analysis) {
        return `An√°lise para a forma√ß√£o ${formation} n√£o encontrada.`;
    }

    return `
### üß† **Filosofia de Jogo**
${analysis.philosophy}

### ‚úÖ <strong class="text-green-400">Pontos Fortes</strong>
${analysis.strength}

### ‚ùå <strong class="text-red-400">Pontos Fracos</strong>
${analysis.weakness}

### üèÜ **Instru√ß√£o Chave**
${analysis.instruction}
    `.trim();
}

// --- Individual Player Tactics by Formation ---

const playerTacticsByFormation: Record<string, Record<string, Record<'offensive' | 'defensive', string[]>>> = {
    // --- CAMPO (11v11) ---
    '4-4-2': {
        'Atacante': {
            offensive: ["Trabalhe em dupla com seu parceiro de ataque. Um busca o espa√ßo, o outro segura a bola.", "Ataque o espa√ßo entre o zagueiro e o lateral advers√°rio.", "Seja a primeira linha de press√£o na sa√≠da de bola do advers√°rio."],
            defensive: ["Feche o passe para o primeiro volante advers√°rio.", "N√£o se desgaste perseguindo laterais; concentre-se nos zagueiros.", "Force o erro na constru√ß√£o da jogada advers√°ria."]
        },
        'Meio-campista': {
            offensive: ["Se voc√™ √© um meia central, infiltre na √°rea como surpresa. Se √© um meia lateral, busque a linha de fundo.", "Apoie os atacantes e crie superioridade num√©rica no setor ofensivo.", "Alterne o ritmo do jogo com passes curtos e longos."],
            defensive: ["Mantenha a compacta√ß√£o da linha de 4 no meio. N√£o d√™ espa√ßos entre voc√™ e seus companheiros.", "Dobre a marca√ß√£o nos pontas advers√°rios para ajudar seu lateral.", "Feche a linha de passe por dentro, for√ßando o advers√°rio para as laterais."]
        },
        'Defensor': {
            offensive: ["Seja uma op√ß√£o de passe para sair da press√£o. Avance com a bola apenas se houver espa√ßo.", "Laterais: deem amplitude ao time, mas subam de forma alternada.", "Zagueiros: acertem o passe longo para o atacante que ataca o espa√ßo."],
            defensive: ["Mantenha a linha defensiva alta e compacta. Comunique-se constantemente.", "Laterais: cuidado com as bolas nas suas costas. A cobertura do meia √© fundamental.", "Zagueiros: aten√ß√£o na marca√ß√£o do seu atacante de refer√™ncia e na cobertura do companheiro."]
        },
        'Goleiro': {
            offensive: ["Reponha a bola rapidamente para os meias laterais, iniciando o contra-ataque.", "Seja uma op√ß√£o de recuo segura para os zagueiros."],
            defensive: ["Comande a linha de 4. Sua vis√£o √© privilegiada para corrigir o posicionamento.", "Organize a barreira e a marca√ß√£o nas bolas paradas."]
        }
    },
    '4-3-3': {
        'Atacante': {
            offensive: ["Pontas: cortem para dentro para finalizar ou busquem a linha de fundo para cruzar. Centroavante: seja a refer√™ncia na √°rea.", "A movimenta√ß√£o do trio de ataque √© a chave. Troquem de posi√ß√£o para confundir a zaga.", "Pressione alto. A perda da posse deve ser seguida de uma tentativa imediata de recupera√ß√£o."],
            defensive: ["Sua fun√ß√£o defensiva √© crucial. Feche os laterais advers√°rios e force-os a voltar o jogo.", "Direcione a press√£o para for√ßar o advers√°rio a errar o passe.", "Recomponha rapidamente para formar uma linha de 5 no meio-campo quando necess√°rio."]
        },
        'Meio-campista': {
            offensive: ["O volante d√° o equil√≠brio. Os dois meias t√™m liberdade para se aproximar do ataque.", "Busque passes em profundidade para os pontas nas costas da zaga.", "Um dos meias deve sempre se apresentar como op√ß√£o de finaliza√ß√£o na entrada da √°rea."],
            defensive: ["O trio do meio precisa cobrir uma grande faixa do campo. A bascula√ß√£o precisa ser perfeita.", "Cuidado com o espa√ßo entre a linha de meio e a de defesa.", "O volante √© a prote√ß√£o da zaga. N√£o suba ao mesmo tempo que os outros meias."]
        },
        'Defensor': {
            offensive: ["Laterais: apoiem com consist√™ncia, j√° que os pontas abrem o campo para voc√™s.", "Zagueiros: tenham qualidade no passe para iniciar a constru√ß√£o desde tr√°s.", "Aproveitem a bola parada ofensiva; o time tem presen√ßa de √°rea."],
            defensive: ["Com os laterais subindo, os zagueiros ficam mais expostos. A cobertura precisa ser r√°pida.", "Aten√ß√£o m√°xima nos contra-ataques, principalmente nas costas dos laterais.", "Comunica√ß√£o para manter a linha defensiva organizada e evitar o mano a mano."]
        },
        'Goleiro': {
            offensive: ["Seja r√°pido na reposi√ß√£o para aproveitar os pontas velocistas.", "Use os p√©s para ser o primeiro homem na constru√ß√£o da jogada."],
            defensive: ["Atue como um 'l√≠bero' para cobrir as bolas longas nas costas da sua zaga.", "Fale o tempo todo. A defesa em um 4-3-3 depende de organiza√ß√£o verbal."]
        }
    },
    '3-5-2': {
        'Atacante': {
            offensive: ["Trabalhe em conjunto. Um ataca o espa√ßo enquanto o outro busca a bola no p√©.", "Fa√ßa o piv√¥ para a chegada dos alas e do meia de liga√ß√£o.", "Movimente-se para os lados para abrir espa√ßos no centro da defesa advers√°ria."],
            defensive: ["Sejam os primeiros a pressionar, direcionando a sa√≠da de bola advers√°ria para onde o time tem mais gente.", "Fechem a linha de passe para os zagueiros e volantes advers√°rios."]
        },
        'Meio-campista': {
            offensive: ["Alas: voc√™s s√£o a alma do time. Ataquem com profundidade e cruzem com qualidade.", "Meia de liga√ß√£o: flutue entre as linhas advers√°rias e distribua o jogo.", "Volantes: deem o suporte defensivo e iniciem as jogadas com passes precisos."],
            defensive: ["Alas: sua recomposi√ß√£o √© a chave para a defesa n√£o sofrer. Voltem na linha da defesa se necess√°rio.", "Volantes: protejam a entrada da √°rea e cubram os espa√ßos deixados pelos alas.", "Fechem o meio. Com 5 no setor, o advers√°rio n√£o pode ter espa√ßo para pensar."]
        },
        'Defensor': {
            offensive: ["O zagueiro do centro pode, ocasionalmente, conduzir a bola para quebrar a primeira linha de marca√ß√£o.", "Zagueiros laterais: cubram os alas quando eles subirem."],
            defensive: ["A linha de 3 precisa ser muito bem coordenada. Cuidado com as bolas entre os zagueiros.", "Estejam preparados para cobrir os lados do campo, pois os alas podem demorar a recompor.", "Comunica√ß√£o √© vital para decidir quem sai para o combate e quem fica na sobra."]
        },
        'Goleiro': {
            offensive: ["Procure os alas com lan√ßamentos longos para pegar o advers√°rio de surpresa.", "Aja como op√ß√£o de passe para desafogar a defesa."],
            defensive: ["Organize a defesa de 3 homens, indicando quem deve pressionar e quem deve cobrir.", "Esteja atento √†s sa√≠das do gol para interceptar bolas nas costas da zaga."]
        }
    },
    // ... Simplified entries for other formations to save space
    '4-2-3-1': {
        'Atacante': {
            offensive: ["Seja o ponto de refer√™ncia, segure os zagueiros e abra espa√ßo para o meia-atacante.", "Pressione a sa√≠da de bola para for√ßar o erro."],
            defensive: ["Feche a linha de passe para os zagueiros, impedindo a constru√ß√£o do jogo advers√°rio."]
        },
        'Meio-campista': {
            offensive: ["Meia-atacante (10): voc√™ √© o c√©rebro. Flutue, encontre passes e finalize.", "Pontas: usem a velocidade para o 1x1. Volantes: um protege, o outro apoia."],
            defensive: ["Volantes: protejam a frente da √°rea. Meias: recomponham para criar duas linhas de 4 sem a bola."]
        },
        'Defensor': {
            offensive: ["Laterais: subam com intelig√™ncia, aproveitando que os pontas criam espa√ßo.", "Zagueiros: iniciem o jogo com passes seguros para os volantes."],
            defensive: ["Mantenham a linha de 4 compacta. Comuniquem-se para cobrir os espa√ßos.", "Cuidado com a transi√ß√£o defensiva quando os laterais est√£o no ataque."]
        },
        'Goleiro': {
            offensive: ["Busque o meia-atacante ou os pontas com reposi√ß√µes r√°pidas.", "Seja uma op√ß√£o de passe para os volantes."],
            defensive: ["Organize a defesa e os volantes. Sua vis√£o de tr√°s √© fundamental.", "Esteja pronto para sa√≠das corajosas."]
        }
    },
    '2-3-1': {
        'Atacante': {
            offensive: ["Fa√ßa o piv√¥. Segure a bola e espere a chegada dos meias.", "Movimente-se para criar linhas de passe para o meia-atacante."],
            defensive: ["Pressione o zagueiro com a bola, dificultando a sa√≠da."]
        },
        'Meio-campista': {
            offensive: ["Meia-atacante: seja criativo, drible, passe e chute.", "Alas: deem amplitude e profundidade. Cheguem na √°rea para finalizar."],
            defensive: ["Volante: voc√™ √© o escudo da zaga. Fique posicionado.", "Alas: voltem para ajudar os zagueiros. Sem a bola, o time defende com 4."]
        },
        'Defensor': {
            offensive: ["N√£o se arrisquem muito. O passe seguro para o volante √© a melhor op√ß√£o.", "Subam apenas em situa√ß√µes claras de superioridade."],
            defensive: ["Fiquem atentos, pois voc√™s estar√£o no mano a mano com frequ√™ncia.", "Comunica√ß√£o √© chave para a cobertura m√∫tua."]
        },
        'Goleiro': {
            offensive: ["Procure os alas ou o atacante com lan√ßamentos r√°pidos.", "Seja o ponto de seguran√ßa para a defesa."],
            defensive: ["Organize a defesa e o volante. Fale alto e com clareza.", "Esteja preparado para chutes de longa dist√¢ncia."]
        }
    },
    '3-2-1': {
        'Atacante': {
            offensive: ["Lute sozinho contra a defesa. Segure a bola at√© o time chegar.", "Seja oportunista. Cada chance √© valiosa."],
            defensive: ["Pressione a sa√≠da de bola para retardar o ataque advers√°rio."]
        },
        'Meio-campista': {
            offensive: ["Sejam os pulm√µes do time. Liguem a defesa ao ataque.", "Infiltrem na √°rea como elemento surpresa. Chutem de fora."],
            defensive: ["Fechem o meio e ajudem a proteger os espa√ßos nas laterais.", "Trabalhem juntos para formar uma barreira √† frente da defesa."]
        },
        'Defensor': {
            offensive: ["Os zagueiros laterais podem apoiar como alas, mas com cautela.", "O zagueiro central √© o l√≠der da constru√ß√£o."],
            defensive: ["Comunica√ß√£o constante para manter a linha de 3 compacta.", "N√£o permitam que o advers√°rio jogue entre voc√™s."]
        },
        'Goleiro': {
            offensive: ["Use a reposi√ß√£o como uma arma para iniciar o ataque.", "Seja uma v√°lvula de escape para os zagueiros."],
            defensive: ["Comande a linha de 3 e os dois meias √† frente.", "Esteja preparado para defender chutes de todas as dist√¢ncias."]
        }
    },
    '2-2-2': {
        'Atacante': {
            offensive: ["Trabalhem em dupla, um buscando espa√ßo e o outro o passe.", "Movimentem-se para n√£o ficarem na mesma linha."],
            defensive: ["Pressionem os zagueiros advers√°rios de forma coordenada."]
        },
        'Meio-campista': {
            offensive: ["Conectem a defesa e o ataque com passes curtos e r√°pidos.", "Um sobe, o outro fica para dar equil√≠brio."],
            defensive: ["Mantenham a compacta√ß√£o. N√£o deixem espa√ßo entre voc√™s.", "Ajudem os zagueiros e os atacantes na marca√ß√£o."]
        },
        'Defensor': {
            offensive: ["Iniciem o jogo com passes seguros para o meio-campo.", "Subam apenas quando tiverem certeza da cobertura."],
            defensive: ["Trabalhem em un√≠ssono. Se um sai para ca√ßar, o outro cobre.", "Evitem o mano a mano e protejam a √°rea."]
        },
        'Goleiro': {
            offensive: ["Jogue curto com os zagueiros para iniciar a posse.", "Seja r√°pido na reposi√ß√£o para os atacantes."],
            defensive: ["Organize as duas linhas de 2 √† sua frente.", "Esteja atento aos chutes de m√©dia dist√¢ncia."]
        }
    },
    '2-2': {
        'Atacante': { // No futsal, chamados de Alas/Piv√¥
            offensive: ["Movimentem-se constantemente. O rod√≠zio √© a chave para abrir espa√ßos.", "Busquem tabelas e jogadas de um-dois."],
            defensive: ["Sejam a primeira linha de defesa, pressionando a sa√≠da de bola advers√°ria."]
        },
        'Meio-campista': { // N√£o se aplica, usamos Fixo
            offensive: [""],
            defensive: [""]
        },
        'Defensor': { // No futsal, chamados de Fixos
            offensive: ["Subam para o ataque como surpresa, mas garantam que algu√©m fa√ßa a cobertura.", "Tenham qualidade no passe para armar o jogo."],
            defensive: ["Sejam a base da defesa. Comuniquem-se para cobrir um ao outro.", "N√£o deem botes desnecess√°rios; cerquem o advers√°rio."]
        },
        'Goleiro': {
            offensive: ["Atue como um 'goleiro-linha' quando o time precisar, sendo uma op√ß√£o de passe a mais.", "Lance a bola rapidamente para os alas em contra-ataques."],
            defensive: ["Organize a defesa 'quadrada' e feche o gol nos chutes.", "Esteja preparado para defender com os p√©s."]
        }
    },
    '3-1': {
        'Atacante': { // Piv√¥
            offensive: ["Voc√™ √© a refer√™ncia. Segure a bola de costas, proteja e espere a chegada dos alas.", "Fa√ßa o piv√¥ e role a bola para quem vem de frente para finalizar."],
            defensive: ["Pressione o fixo advers√°rio, dificultando a arma√ß√£o das jogadas."]
        },
        'Meio-campista': { // Alas
            offensive: ["Ataquem o espa√ßo quando o piv√¥ receber a bola. Infiltrem em diagonal.", "Sejam a op√ß√£o de passe para o piv√¥. Chutem de m√©dia dist√¢ncia."],
            defensive: ["Recomponham rapidamente para formar uma linha de 3 com o fixo.", "Marquem os alas advers√°rios individualmente."]
        },
        'Defensor': { // Fixo
            offensive: ["Seja o armador do time, iniciando as jogadas com passes precisos para os alas ou o piv√¥.", "Avance com cautela para n√£o desguarnecer a defesa."],
            defensive: ["Voc√™ √© o √∫ltimo homem. Comande a defesa e fa√ßa a cobertura dos alas.", "Seja implac√°vel no desarme, mas evite faltas."]
        },
        'Goleiro': {
            offensive: ["Procure o piv√¥ com lan√ßamentos diretos e precisos.", "Jogue com os p√©s para ajudar na sa√≠da de bola."],
            defensive: ["Organize a defesa e fique atento √†s infiltra√ß√µes dos alas advers√°rios.", "Feche bem o √¢ngulo contra o piv√¥."]
        }
    },
    '1-2-1': {
        'Atacante': { // Piv√¥
            offensive: ["Movimente-se para abrir espa√ßos e ser op√ß√£o de passe. N√£o fique parado.", "Finalize r√°pido assim que receber a bola em condi√ß√£o."],
            defensive: ["Pressione o jogador que inicia a jogada advers√°ria."]
        },
        'Meio-campista': { // Alas
            offensive: ["Sejam a principal v√°lvula de escape do time. Usem a velocidade.", "Busquem tabelas com o fixo e o piv√¥. Chutem de fora."],
            defensive: ["Fechem as laterais da quadra e ajudem o fixo na marca√ß√£o.", "Recomponham com velocidade m√°xima."]
        },
        'Defensor': { // Fixo
            offensive: ["Voc√™ √© o equil√≠brio do time. D√™ qualidade ao passe e comande o ritmo.", "Apoie o ataque, mas seja o primeiro a voltar."],
            defensive: ["Seja o c√£o de guarda da defesa. Intercepte passes e fa√ßa desarmes.", "Organize a marca√ß√£o do losango."]
        },
        'Goleiro': {
            offensive: ["Participe ativamente da constru√ß√£o do jogo com passes precisos.", "Busque os alas em velocidade para o contra-ataque."],
            defensive: ["Sua comunica√ß√£o √© vital para o sistema de losango funcionar.", "Esteja preparado para defender em situa√ß√µes de 1 contra 1."]
        }
    }
};

// --- Player Tactic Getter Function ---
export function getPlayerTactic(formation: string, type: 'offensive' | 'defensive', position: Player['position']): string {
    const formationTactics = playerTacticsByFormation[formation];
    
    if (!formationTactics) {
        return "Instru√ß√£o t√°tica n√£o dispon√≠vel para esta forma√ß√£o.";
    }

    // Adapt position for Futsal inside the function
    let tacticalPosition = position;
    if (['2-2', '3-1', '1-2-1'].includes(formation)) {
        if (position === 'Meio-campista') tacticalPosition = 'Atacante'; // Treat midfielders as attackers (alas) in futsal
    }

    const positionTactics = formationTactics[tacticalPosition];

    if (!positionTactics || !positionTactics[type] || positionTactics[type].length === 0) {
        // Fallback for generic positions if specific one is missing (e.g., Meio-campista in 2-2)
         const genericTactics = playerTacticsByFormation['4-4-2'][position]?.[type];
         if (genericTactics && genericTactics.length > 0) return pickRandom(genericTactics);
         return "Seja vers√°til e adapte-se √†s necessidades do jogo.";
    }

    return pickRandom(positionTactics[type]);
}
